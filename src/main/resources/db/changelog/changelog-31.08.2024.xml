<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="create_auth_client_table" author="Quang Nguyen">
        <sql>
            CREATE TABLE oauth2_registered_client
            (
                id                            VARCHAR(100) PRIMARY KEY,
                client_id                     VARCHAR(100)  NOT NULL,
                client_id_issued_at           TIMESTAMP WITH TIME ZONE,
                client_secret                 VARCHAR(200),
                client_secret_expires_at      TIMESTAMP WITH TIME ZONE,
                client_name                   VARCHAR(200)  NOT NULL,
                client_authentication_methods VARCHAR(1000) NOT NULL,
                authorization_grant_types     VARCHAR(1000) NOT NULL,
                redirect_uris                 VARCHAR(1000),
                post_logout_redirect_uris     VARCHAR(1000),
                scopes                        VARCHAR(1000),
                client_settings               BYTEA         NOT NULL,
                token_settings                BYTEA         NOT NULL
            );
        </sql>
    </changeSet>

    <changeSet id="drop_not_null_constraint" author="Quang Nguyen">
        <sql>
            ALTER TABLE oauth2_registered_client
            ALTER COLUMN client_authentication_methods DROP NOT NULL,
            ALTER COLUMN authorization_grant_types DROP NOT NULL,
            ALTER COLUMN client_settings DROP NOT NULL,
            ALTER COLUMN token_settings DROP NOT NULL;
        </sql>
    </changeSet>

    <changeSet id="change_datatype_settings" author="Quang Nguyen">
        <sql>
            ALTER TABLE oauth2_registered_client
            ALTER COLUMN client_settings SET DATA TYPE VARCHAR,
            ALTER COLUMN token_settings SET DATA TYPE VARCHAR;
        </sql>
    </changeSet>
</databaseChangeLog>